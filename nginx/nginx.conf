upstream django {
    server backend:2025;
}

server {
    listen 80;
    client_max_body_size 500M;

    # üîë –°–Ω–∞—á–∞–ª–∞ ‚Äî –≤—Å–µ –ø—Ä–æ–∫—Å–∏-–ø—Ä–∞–≤–∏–ª–∞
    location /backup-api/ {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /admin/ {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /swagger/ {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /ws/ {
        proxy_pass http://django;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 8640s;
        proxy_cache_bypass $http_upgrade;
    }

    # –ó–∞—Ç–µ–º ‚Äî —Å—Ç–∞—Ç–∏–∫–∞
    location /django-static/ {
        alias /app/staticfiles/;
    }

    # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä ^~ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
    location ^~ /media/backups/ {
        deny all;
        return 404;
    }

    # ‚úÖ –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ /media/ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –æ–Ω–∏ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã
    location /media/ {
        alias /app/media/;
    }

    # –ò –¢–û–õ–¨–ö–û –í –ö–û–ù–¶–ï ‚Äî SPA fallback
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
}